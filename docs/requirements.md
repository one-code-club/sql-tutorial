# SQL Builder - 要件定義書

## 1. はじめに

### 1.1 目的
「SQL Builder」は、小中学生を対象に、SQL文の学習・練習を支援する Web アプリです。学習者がインタラクティブに SQL を組み立て、実行結果を即座に確認できる環境を提供し、初心者でも楽しく直感的に学べる体験を目指します。

### 1.2 想定利用者
- 小学生〜中学生（SQL 初学者）
- 教師／保護者（進捗確認機能は将来的に追加予定）

### 1.3 スコープ
#### 対応範囲
- 基本的な SQL 文（`SELECT`, `WHERE`, `ORDER BY`, `LIMIT` 等）を実行形式で学習・練習できる画面
- SQL文はテキスト手入力ではなく、DB名・カラム名・SQLキーワードを**左ペインからドラッグ＆ドロップ**して組み立てるビジュアルコーディング方式
- DBのデータはローカル `/data` ディレクトリの CSV ファイルから取得し、クエリ実行結果を右ペインに表示
- フロントエンドは Next.js（TypeScript）、UI は Tailwind CSS（ShadCN UI）を使用
- Prisma ORM + Supabase PostgreSQL によるデータ保存（ニックネーム・クエリ）

#### 非対応範囲
- ユーザー認証／アカウント管理
- 進捗記録や成績管理
- 複雑な SQL 文（JOIN、サブクエリ等）

---

## 2. 全体構成

### 2.1 技術スタック（予定）
| レイヤー        | 技術                        | 備考 |
|-----------------|-----------------------------|------|
| フロントエンド  | Next.js + TypeScript         | React ベース、型安全 |
| UI/スタイリング | Tailwind CSS + ShadCN UI     | コンポーネントライブラリ利用 |
| データ管理      | Prisma ORM + Supabase PG     | クエリやニックネーム保存 |
| データ取得      | CSVファイル（ローカル）      | `/data` ディレクトリからロード |

---

## 3. 機能要件

### 3.1 ログイン画面
- ニックネーム入力欄
  - 認証は行わず、ニックネームを記録用に使用
  - ニックネームはユニーク制約あり
  - 重複時はエラーメッセージ表示：「その名前はすでに使われています。別の名前を入力してください。」
- 入力成功時はメイン画面へ遷移

### 3.2 メイン画面構成
#### ヘッダー
- アプリ名表示
- ログアウトボタン（任意実装）

#### 左ペイン（DB／カラム／バッジ／保存クエリ）
- **DB選択ドロップダウン**
  - `/data` ディレクトリ内 CSV ファイル名をロード
  - 選択時にデータを読み込み
- **バッジ一覧**
  - SQLキーワード（オレンジ色）：`SELECT`, `FROM`, `WHERE`, `AND`, `OR`, `LIMIT`, `MIN`, `MAX`
  - カラム名（水色）：選択中のDBのカラム名
- **保存クエリ一覧**
  - Supabase に保存されたクエリを一覧表示（ニックネーム別）
  - 各クエリには削除ボタンあり

#### 中ペイン（SQLエディタ）
- ドラッグ＆ドロップで左ペインのバッジを挿入（先頭に半角スペース付与）
- エディタ内で手動編集可
- 「実行」ボタンで右ペインに結果を表示
- 「保存」ボタンでクエリ保存
  - 保存時はモーダル表示で名前入力 → Supabase に保存（ニックネーム・クエリ名・クエリ本文）

#### 右ペイン（結果表示）
- 実行結果をグリッド（Excel風）で表示
- スクロール、カラムソート可（任意）

---

## 4. 非機能要件
- **パフォーマンス**：CSVの読み込みは遅延ロード
- **UI/UX**：小中学生向けにわかりやすい色・フォントサイズ
- **レスポンシブ対応**：PC・タブレットで快適に利用可能

---

## 5. 受け入れ基準（テスト観点）

1. **ニックネーム入力**
   - ユニークであればメイン画面に遷移
   - 重複時はエラー表示
2. **DB選択**
   - `/data` ディレクトリのCSVファイル名がドロップダウンに表示される
   - 選択時に左ペインにカラム名バッジが表示される
3. **クエリ保存・削除**
   - 保存時はモーダルで名前入力
   - 保存成功後、左ペインのリストに追加
   - 削除ボタンで削除できる
4. **ドラッグ＆ドロップ**
   - バッジをエディタにドロップすると先頭に半角スペース付きで挿入
5. **クエリ実行**
   - 「実行」クリックで右ペインに結果表示
   - 表示はグリッド形式

---

## 6. 将来的な展開
- 管理者ダッシュボード
  - ニックネーム一覧
  - 各ユーザーの保存クエリ表示
  - SQL課題と正解判定機能
